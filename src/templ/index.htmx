<!DOCTYPE html>
<html lang="en">
<head>
    <title>loic's server</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script src="js/util.js"></script> -->
</head>
<body>

    <div><canvas id='annual-by-month'></canvas></div>
    <div style="width: 400px"><canvas id='annual-by-category'></canvas></div>

            <script>
            function running_totals(values) {
                ttl = 0;
                return values.map((val) => { ttl += val; return ttl; });
            }

            function total(values) {
                return values.reduce((acc, val) => acc + val, 0);
            }

            const months = [ 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec' ];

            //const monthly_budget = util.numbers({ count: 12, min: 300, max: 6000 });
            // const monthly_actual = util.numbers({ count: util.rand(3, 9), min: 3000, max: 6000 });

            const monthly_budget = [ {{#budget}}{{.}},{{/budget}} ];
            const monthly_actual = [ {{#actual}}{{.}},{{/actual}} ];

            const monthly_budget_aggr = running_totals(monthly_budget);
            const monthly_actual_aggr = running_totals(monthly_actual);

            const projected_actual = new Array(12);
            var rt = total(monthly_actual);
            projected_actual[monthly_actual.length - 1] = rt;
            for (i = monthly_actual.length; i < 12; i++) {
                rt += monthly_budget[i];
                projected_actual[i] = rt;
            }
        </script>

        <script>

            new Chart(
                document.getElementById('annual-by-month'),
                {
                    data: {
                        labels: months,
                        datasets: [
                            {
                                type: 'line',
                                label: 'YTD Budget',
                                yAxisID: 'y-aggr',
                                data: monthly_budget_aggr,
                            },
                            {
                                type: 'line',
                                label: 'YTD Actual',
                                yAxisID: 'y-aggr',
                                data: monthly_actual_aggr,
                            },
                            {
                                type: 'line',
                                label: 'YTD Projection',
                                yAxisID: 'y-aggr',
                                borderDash: [5, 15],
                                data: projected_actual,
                            },
                            {
                                type: 'bar',
                                label: 'Montly Budget',
                                borderWidth: 2,
                                stack: 'budget',
                                data: monthly_budget,
                            },
                            {
                                type: 'bar',
                                label: 'Montly Actuals',
                                borderWidth: 2,
                                stack: 'actual',
                                data: monthly_actual,
                            },
                        ]
                    },
                    options: {
                        scales: {
                            y: {
                                type: 'linear',
                                position: 'left',
                            },
                            'y-aggr': {
                                type: 'linear',
                                position: 'right',
                            },
                        },
                        onClick: function(a,b,c) {
                            console.log('handling: ', a, b, c);
                        },
                    }
                }
            );
        </script>


</body>
</html>


